{"version":3,"sources":["user.js"],"names":["$","$btnDeactivate","$btnReactivate","$btnSignTos","changeChoiceColor","forEach","state","find","each","this","is","css","generatePassword","charset","password","i","n","length","charAt","Math","floor","random","document","ready","on","$this","$input","data","hasClass","attr","removeClass","addClass","e","preventDefault","val","change","click","message","showDialog","user","text","post","resp","showAlert","msg","updateUpdatedBy","setTimeout","window","location","reload","fail","xhr","JSON","parse","responseText","always","initDatatable","table","filter","search","form","input","pagination","basic","columns","className","render","type","row","selected","$dioceses","includes","prop","index","toUpperCase","select2","split","current_dioceses","val_d","url","html","show","ajax","dataType","done","hide","jQuery"],"mappings":"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","file":"user.min.js","sourcesContent":["/* global bootbox */\r\n/* global initDatatable */\r\n/* global showDialog */\r\n/* global showAlert */\r\n/* global updateUpdatedBy */\r\n/* global diocesan_councils */\r\n\r\n'use strict';\r\n\r\n(function ($) {\r\n    var $btnDeactivate = $('.js-btn-user-deactivate');\r\n    var $btnReactivate = $('.js-btn-user-reactivate');\r\n    var $btnSignTos = $('.js-btn-user-signtos');\r\n\r\n\r\n    var changeChoiceColor = function () {\r\n        var states = ['National','Canberra and Goulburn','New South Wales','Northern Territory','Queensland','South Australia','Tasmania','Victoria','Western Australia'];\r\n\r\n        states.forEach(function(state){\r\n            $(\"#dioceses\").find(\"li\").each(function(){\r\n                if( $(this).is(\"[title='\" + state + \"']\") ){\r\n                    $(this)\r\n                        .css(\"background-color\", \"#00ffff\");\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    var generatePassword = function () {\r\n        var charset  = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()';\r\n        var length   = 16;\r\n        var password = '';\r\n\r\n        for (var i = 0, n = charset.length; i < length; ++i) {\r\n            password += charset.charAt(Math.floor(Math.random() * n));\r\n        }\r\n\r\n        return password;\r\n    };\r\n\r\n    $(document).ready(function () {\r\n        $('.js-toggle-password').on('click', function () {\r\n            var $this  = $(this);\r\n            var $input = $($this.data('target'));\r\n\r\n            if ($this.find('.fa').hasClass('fa-eye')) {\r\n                $input.attr('type', 'text');\r\n                $this.find('.fa').removeClass('fa-eye').addClass('fa-eye-slash');\r\n            } else {\r\n                $input.attr('type', 'password');\r\n                $this.find('.fa').removeClass('fa-eye-slash').addClass('fa-eye');\r\n            }\r\n        });\r\n\r\n        $('.js-generate-password').on('click', function (e) {\r\n            e.preventDefault();\r\n\r\n            var password = generatePassword();\r\n            var $input   = $($(this).data('target'));\r\n\r\n            $input.val(password).change();\r\n\r\n            if ($input.attr('type') === 'password') {\r\n                $('.js-toggle-password').click();\r\n            }\r\n        });\r\n\r\n        $btnDeactivate.on('click', function (e) {\r\n            e.preventDefault();\r\n\r\n            var message = '<p>Are you sure you want to deactivate ' + $('#first_name').val() + ' ' + $('#last_name').val() + '?</p>';\r\n\r\n            showDialog(message, true, function () {\r\n                var data = {\r\n                    user: $btnDeactivate.data('user-id')\r\n                };\r\n\r\n                $btnDeactivate.text($btnDeactivate.data('text-progress'));\r\n\r\n                $.post('/users/deactivate', data, function (resp) {\r\n                    showAlert(resp.msg, 'success');\r\n                    updateUpdatedBy();\r\n\r\n                    setTimeout(function () {\r\n                        window.location.reload();\r\n                    }, 1000);\r\n                }).fail(function (xhr) {\r\n                    var resp = JSON.parse(xhr.responseText);\r\n                    showAlert(resp.msg, 'danger');\r\n                }).always(function () {\r\n                    $btnDeactivate.text($btnDeactivate.data('text-default'));\r\n                });\r\n            });\r\n        });\r\n\r\n        $btnReactivate.on('click', function (e) {\r\n            e.preventDefault();\r\n\r\n            var message = '<p>Are you sure you want to reactivate ' + $('#first_name').val() + ' ' + $('#last_name').val() + '?</p>';\r\n\r\n            showDialog(message, true, function () {\r\n                var data = {\r\n                    user: $btnReactivate.data('user-id')\r\n                };\r\n\r\n                $btnReactivate.text($btnReactivate.data('text-progress'));\r\n\r\n                $.post('/users/reactivate', data, function (resp) {\r\n                    showAlert(resp.msg, 'success');\r\n                    updateUpdatedBy();\r\n\r\n                    setTimeout(function () {\r\n                        window.location.reload();\r\n                    }, 1000);\r\n                }).fail(function (xhr) {\r\n                    var resp = JSON.parse(xhr.responseText);\r\n                    showAlert(resp.msg, 'danger');\r\n                }).always(function () {\r\n                    $btnReactivate.text($btnReactivate.data('text-default'));\r\n                });\r\n            });\r\n        });\r\n\r\n        $btnSignTos.on('click', function (e) {\r\n            e.preventDefault();\r\n\r\n            var message = '<p>Are you sure you want to ask ' + $('#first_name').val() + ' ' + $('#last_name').val() + ' to re-sign Term of Use ?</p>';\r\n\r\n            showDialog(message, true, function () {\r\n                var data = {\r\n                    user: $btnSignTos.data('user-id')\r\n                };\r\n\r\n                $btnSignTos.text($btnSignTos.data('text-progress'));\r\n\r\n                $.post('/users/signtos', data, function (resp) {\r\n                    showAlert(resp.msg, 'success');\r\n                    updateUpdatedBy();\r\n\r\n                    setTimeout(function () {\r\n                        window.location.reload();\r\n                    }, 1000);\r\n                }).fail(function (xhr) {\r\n                    var resp = JSON.parse(xhr.responseText);\r\n                    showAlert(resp.msg, 'danger');\r\n                }).always(function () {\r\n                    $btnSignTos.text($btnSignTos.data('text-default'));\r\n                });\r\n            });\r\n        });\r\n\r\n        if ($('.js-table').length) {\r\n            initDatatable({\r\n                table: '.js-table',\r\n                filter: '.js-table-filter',\r\n                search: {\r\n                    form: '.js-table-search-form',\r\n                    input: '.js-table-search-input',\r\n                },\r\n                pagination: {\r\n                    basic: '.pagination-basic',\r\n                    table: '.pagination-table',\r\n                },\r\n                columns: [\r\n                    {\r\n                        data: 'id',\r\n                        className: 'text-center',\r\n                        render: function (data, type, row) {\r\n                            return '<a href=\"/users/edit/' + data + '\">' + data + '</a>';\r\n                        },\r\n                    },\r\n                    {\r\n                        data: 'states',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'first_name',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'last_name',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'role',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'mfa',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'last_login',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'email',\r\n                        className: 'text-center',\r\n                    },\r\n                ]\r\n            });\r\n        }\r\n\r\n        $('[name=\"states[]\"]').on('change', function (e) {\r\n            e.preventDefault();\r\n            var selected  = $(this).val();           \r\n            var $dioceses = $('[name=\"dioceses[]\"]');\r\n\r\n            if ( selected.includes('national') ) {\r\n                // enable all diocesan/central council\r\n                $dioceses.find('option').prop('disabled', false);\r\n                $dioceses.find('option').prop('selected', true); // set all dioceses as selected if state = national\r\n            } else {\r\n                $dioceses.find('option').prop('disabled', true);\r\n                $dioceses.find('option').prop('selected', false);\r\n\r\n                $.each(selected, function (index, val) {\r\n                    $dioceses.find('optgroup[label=\"' + val.toUpperCase() + '\"]').find('option').prop('selected', true);\r\n                    $dioceses.find('optgroup[label=\"' + val.toUpperCase() + '\"]').find('option').prop('disabled', false);\r\n                });\r\n            }\r\n\r\n            $dioceses.select2();\r\n\r\n            changeChoiceColor();\r\n        })\r\n\r\n        $('#dioceses').on('change', function (e) {\r\n            //e.preventDefault();\r\n\r\n            changeChoiceColor();\r\n        })\r\n\r\n        var pathname = (window.location.pathname).split('/');\r\n\r\n        if (pathname.includes('edit')) { // check if edit page \r\n            var selected  = $('[name=\"states[]\"]').val();           \r\n            var current_dioceses = $('[name=\"dioceses[]\"]').val();\r\n            var $dioceses = $('[name=\"dioceses[]\"]');\r\n\r\n            if ( selected.includes('national') ) {\r\n                // enable all diocesan/central council\r\n                $dioceses.find('option').prop('disabled', false);\r\n                $dioceses.find('option').prop('selected', false); // set all dioceses as selected if state = national\r\n\r\n                $.each(current_dioceses, function (index, val) {\r\n                    $dioceses.find('option[value=\"' + val + '\"]').prop('selected', true);\r\n                });\r\n                \r\n            } else {\r\n                $dioceses.find('option').prop('disabled', true);\r\n                $dioceses.find('option').prop('selected', false);\r\n\r\n                $.each(selected, function (index, val) {\r\n\r\n                    $.each(current_dioceses, function (index, val_d) {\r\n                        $dioceses.find('optgroup[label=\"' + val.toUpperCase() + '\"]').find('option[value=\"' + val_d + '\"]').prop('selected', true);\r\n                    });\r\n\r\n                    $dioceses.find('optgroup[label=\"' + val.toUpperCase() + '\"]').find('option').prop('disabled', false);\r\n                });\r\n            }\r\n\r\n            $dioceses.select2();\r\n\r\n            changeChoiceColor();\r\n        }\r\n\r\n        $(document).on('click', '#getActivity', function(e){\r\n            e.preventDefault();\r\n            var url = $(this).data('url');\r\n            $('.message-modal').html(''); \r\n            $('#modal-loader').show();     \r\n            $.ajax({\r\n                url: url,\r\n                type: 'GET',\r\n                dataType: 'html'\r\n            })\r\n            .done(function(data){\r\n               // console.log(data);  \r\n                $('.message-modal').html('');    \r\n                $('.message-modal').html(data); // load response \r\n                $('#modal-loader').hide();        // hide ajax loader   \r\n            })\r\n            .fail(function(){\r\n                $('#dynamic-content').html('<i class=\"glyphicon glyphicon-info-sign\"></i> Something went wrong, Please try again...');\r\n                $('#modal-loader').hide();\r\n            });\r\n        });\r\n\r\n    });\r\n})(jQuery);\r\n"]}

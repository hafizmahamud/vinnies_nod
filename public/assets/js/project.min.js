"use strict";!function(e){var a,t=e("#mustache-donors").html();Mustache.parse(t);var o=function(t){var o={currency:e('[name="currency"]').find("option:selected").val(),local_value:e('[name="local_value"]').val()};void 0!==a&&a.readyState>0&&a.readyState<4&&a.abort(),a=e.post(project_info_url,o,function(a){updateBindings(a,function(a){"No"===a.is_fully_paid?e("#is_fully_paid").find('option[value="0"]').prop("selected",!0):e("#is_fully_paid").find('option[value="1"]').prop("selected",!0)})}).always(function(){t&&t()})},n=function(a){var o=e(".section-donors"),n=o.data("project-id");e.get(project_donors_url,{project_id:n},function(e){o.html(Mustache.render(t,e))}).always(function(){a&&a()})};e(document).ready(function(){e(".js-table").length&&initDatatable({table:".js-table",filter:".js-table-filter",search:{form:".js-table-search-form",input:".js-table-search-input"},pagination:{basic:".pagination-basic",table:".pagination-table"},columns:[{data:"id",className:"text-center",render:function(e,a,t){return'<a href="/projects/edit/'+e+'">'+e+"</a>"}},{data:"status",className:"text-center"},{data:"project_type",className:"text-center"},{data:"name",className:"text-center"},{data:"country",className:"text-center"},{data:"overseas_project_id",className:"text-center",render:function(e,a,t){return"N/A"===e?e:'<a href="/overseas-conferences/edit/'+e+'">'+e+"</a>"}},{data:"received_at",className:"text-center"},{data:"is_awaiting_support",className:"text-center"},{data:"state",className:"text-center"},{data:"au_value",className:"text-center"},{data:"is_fully_paid",className:"text-center"},{data:"balance_owing ",className:"text-center"}]}),e("#modal-beneficiary").on("shown.bs.modal",function(){initDatatable({table:"#modal-beneficiary .js-modal-table",filter:"#modal-beneficiary .js-modal-table-filter",search:{form:"",input:""},pagination:{basic:"#modal-beneficiary .pagination-basic",table:""},columns:[{data:"id",className:"text-center",render:function(e,a,t){return'<div class="checkbox checkbox-warning"><input type="checkbox" name="beneficiary_id" value="'+e+'"><label></label></div>'}},{data:"name",className:"text-center"},{data:"country",className:"text-center"}]}),initForm({form:"#modal-beneficiary .js-modal-form",btn:"#modal-beneficiary .btn-submit-modal-form",beforeSubmitCb:function(){e("#modal-beneficiary .js-modal-form").find("[data-error]").empty().hide()},successCb:function(a,t,o,n){updateBindings(a,function(a){var t=e('[data-bind="beneficiary_name"]');e('.js-form [name="beneficiary_id"]').val(a.beneficiary_id),e("#modal-beneficiary .js-modal-table").attr("data-selected-id",a.beneficiary_id),e("#modal-beneficiary").modal("hide"),t.closest("p").find("a").append(t)})}})}),e("#modal-os-conf").on("shown.bs.modal",function(){initDatatable({table:"#modal-os-conf .js-modal-table",filter:"#modal-os-conf .js-modal-table-filter",search:{form:"#modal-os-conf .js-table-search-form",input:"#modal-os-conf .js-table-search-input"},pagination:{basic:"#modal-os-conf .pagination-basic",table:""},columns:[{data:"select",className:"text-center",render:function(e,a,t){return'<div class="checkbox checkbox-warning"><input type="checkbox" name="overseas_conference_id" value="'+e+'"><label></label></div>'}},{data:"id",className:"text-center"},{data:"name",className:"text-center"},{data:"country",className:"text-center"},{data:"central_council",className:"text-center"},{data:"particular_council",className:"text-center"},{data:"parish",className:"text-center"},{data:"is_active",className:"text-center"}]}),initForm({form:"#modal-os-conf .js-modal-form",btn:"#modal-os-conf .btn-submit-modal-form",beforeSubmitCb:function(){e("#modal-os-conf .js-modal-form").find("[data-error]").empty().hide()},successCb:function(a,t,o,n){updateBindings(a,function(a){var t=e('[data-bind="overseas_conference_id"]'),o=e('[data-bind="overseas_conference_name"]');"N/A"===a.overseas_conference_id?(e('.js-form [name="overseas_conference_id"]').val(""),e("#modal-os-conf .js-modal-table").attr("data-selected-id",""),t.closest("p").append(t),o.closest("p").append(o)):(e('.js-form [name="overseas_conference_id"]').val(a.overseas_conference_id),e("#modal-os-conf .js-modal-table").attr("data-selected-id",a.overseas_conference_id),t.closest("p").find("a").append(t),o.closest("p").find("a").append(o)),e(".row-os-conf p").each(function(){e(this).toggleClass("text-muted","N/A"===a.overseas_conference_id)}),e("#modal-os-conf").modal("hide")})}})}),e("#modal-create-donor").on("shown.bs.modal",function(){initDatatable({table:"#modal-create-donor .js-modal-table",filter:"#modal-create-donor .js-modal-table-filter",search:{form:"#modal-create-donor .js-table-search-form",input:"#modal-create-donor .js-table-search-input"},pagination:{basic:"#modal-create-donor .pagination-basic",table:""},columns:[{data:"select",className:"text-center",render:function(e,a,t){return'<div class="checkbox checkbox-warning"><input type="checkbox" name="local_conference_id" value="'+e+'"><label></label></div>'}},{data:"id",className:"text-center"},{data:"name",className:"text-center"},{data:"state",className:"text-center"},{data:"regional_council",className:"text-center"},{data:"diocesan_council_id",className:"text-center"},{data:"parish",className:"text-center"}]}),initForm({form:"#modal-create-donor .js-modal-form",btn:"#modal-create-donor .btn-submit-modal-form",beforeSubmitCb:function(){e("#modal-create-donor .js-modal-form").find("[data-error]").empty().hide()},successCb:function(a,t,o,i){n(function(){e("#modal-create-donor").modal("hide")}),updateUpdatedBy()}})}),e("#modal-edit-donor").on("shown.bs.modal",function(){initDatatable({table:"#modal-edit-donor .js-modal-table",filter:"#modal-edit-donor .js-modal-table-filter",search:{form:"#modal-edit-donor .js-table-search-form",input:"#modal-edit-donor .js-table-search-input"},pagination:{basic:"#modal-edit-donor .pagination-basic",table:""},columns:[{data:"select",className:"text-center",render:function(e,a,t){return'<div class="checkbox checkbox-warning"><input type="checkbox" name="local_conference_id" value="'+e+'"><label></label></div>'}},{data:"id",className:"text-center"},{data:"name",className:"text-center"},{data:"state",className:"text-center"},{data:"regional_council",className:"text-center"},{data:"diocesan_council_id",className:"text-center"},{data:"parish",className:"text-center"}]}),initForm({form:"#modal-edit-donor .js-modal-form",btn:"#modal-edit-donor .btn-submit-modal-form",beforeSubmitCb:function(){e("#modal-edit-donor .js-modal-form").find("[data-error]").empty().hide()},successCb:function(a,t,o,i){n(function(){e("#modal-edit-donor").modal("hide")}),updateUpdatedBy()}})}),e("#modal-edit-donor").on("show.bs.modal",function(a){var t=e(this),o=e(a.relatedTarget);t.find(".js-modal-table").attr("data-selected-id",o.data("local-conference-id")),t.find(".js-modal-form").attr("action",o.data("edit-url"))}),e("#modal-edit-donor").on("hidden.bs.modal",function(a){var t=e(this);t.find(".js-modal-table").attr("data-selected-id",""),t.find(".js-modal-form").attr("action","#"),t.find(".js-modal-table").DataTable()&&t.find(".js-modal-table").DataTable().destroy()}),e(".section-donors").length&&n(),e(document).on("click",".js-delete-donor",function(a){a.preventDefault();var t=e(this);showDialog("Are you sure you want to delete this Donor and its associated contributions?",!0,function(){t.text(t.data("text-progress")),e.post(t.data("delete-url"),function(a){n(o(e.noop)),updateUpdatedBy()}).fail(function(){showAlert("Something went wrong, please try again later.","danger")}).always(function(){t.text(t.data("text-default"))})})}),e("#modal-create-contribution, #modal-edit-contribution").on("shown.bs.modal",function(a){var t=e(a.relatedTarget);updateBindings({donor_local_conference_id:t.data("local-conference-id"),donor_local_conference_name:t.data("local-conference-name")})}),e("#modal-create-contribution").on("hidden.bs.modal",function(a){e(this).find('[name="paid_at"]').val(""),e(this).find('[name="amount"]').val(""),e(this).find('[name="donor_id"]').val(""),updateBindings({quarter_year:""})}),e("#modal-create-contribution, #modal-edit-contribution").on("shown.bs.modal",function(a){e(this).on({"pick.datepicker":function(e){var a=e.date.getMonth()+1,t=Math.floor((parseInt(a,10)+2)/3);updateBindings({quarter_year:"Q"+t+":"+e.date.getFullYear()})}})}),e("#modal-create-contribution").on("show.bs.modal",function(a){e(this).find('[name="donor_id"]').val(e(a.relatedTarget).data("id"))}),initForm({form:"#update-projects .js-form",btn:"#update-projects .btn-update-form",beforeSubmitCb:function(){e("#update-projects .js-form").find("[data-error]").empty().hide()},successCb:function(e){showAlert(e.msg,"success"),n(o()),updateUpdatedBy()}}),e("#modal-create-contribution").on("shown.bs.modal",function(a){initForm({form:"#modal-create-contribution .js-modal-form",btn:"#modal-create-contribution .btn-submit-modal-form",beforeSubmitCb:function(){e("#modal-create-contribution .js-modal-form").find("[data-error]").empty().hide()},successCb:function(a,t,i,d){n(o(function(){e("#modal-create-contribution").modal("hide")})),updateUpdatedBy()}})}),e("#modal-edit-contribution").on("show.bs.modal",function(a){var t=e(this),o=e(a.relatedTarget);t.find('[name="paid_at"]').val(o.data("paid-at")),t.find('[name="amount"]').val(o.data("amount")),t.find('[name="donor_id"]').val(o.data("local-conference-id")),t.find(".js-modal-form").attr("action",o.data("edit-url"));var n=o.data("paid-at").split("/"),i=Math.floor((parseInt(n[1],10)+2)/3);updateBindings({quarter_year:"Q"+i+":"+n[2]})}),e("#modal-edit-contribution").on("hidden.bs.modal",function(a){var t=e(this);t.find('[name="paid_at"]').val(""),t.find('[name="amount"]').val(""),t.find('[name="donor_id"]').val(""),t.find(".js-modal-form").attr("action","#")}),e("#modal-edit-contribution").on("shown.bs.modal",function(a){initForm({form:"#modal-edit-contribution .js-modal-form",btn:"#modal-edit-contribution .btn-submit-modal-form",beforeSubmitCb:function(){e("#modal-edit-contribution .js-modal-form").find("[data-error]").empty().hide()},successCb:function(a,t,i,d){n(o(function(){e("#modal-edit-contribution").modal("hide")})),updateUpdatedBy()}})}),e(document).on("click",".js-delete-contribution",function(a){a.preventDefault();var t=e(this);showDialog("Are you sure you want to delete this payment?",!0,function(){t.text(t.data("text-progress")),e.post(t.data("delete-url"),function(e){n(o),updateUpdatedBy()}).fail(function(){showAlert("Something went wrong, please try again later.","danger")}).always(function(){t.text(t.data("text-default"))})})}),e(document).on("click",".js-btn-export-projects",function(a){a.preventDefault();var t={filters:{country:e('[name="country"]').find("option:selected").val(),status:e('[name="status"]').find("option:selected").val(),project_type:e('[name="project_type"]').find("option:selected").val(),state:e('[name="state"]').find("option:selected").val(),is_awaiting_support:e('[name="is_awaiting_support"]').find("option:selected").val(),is_fully_paid:e('[name="is_fully_paid"]').find("option:selected").val(),project_completed:e('[name="project_completed"]').find("option:selected").val(),completion_report_received:e('[name="completion_report_received"]').find("option:selected").val()},search:{value:e(".js-table-search-input").val()}};window.location=project_export_url+"?"+e.param(t)})})}(jQuery);
//# sourceMappingURL=project.min.js.map

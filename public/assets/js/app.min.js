"use strict";!function(t){function e(t,e){var a,n;Math.min(e,5);return e<=5?(a=1,n=e):t<=3?(a=1,n=5):t>=e-2?(a=e-4,n=e):(a=t-2,n=t+2),{startPage:a,endPage:n}}t.ajaxSetup({headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content")}}),t.fn.select2.defaults.set("theme","bootstrap");var a=t("#mustache-documents").html(),n=!1;Mustache.parse(a);var o,s=function(t,e,a,n){t=(t+"").replace(/[^0-9+\-Ee.]/g,"");var o=isFinite(+t)?+t:0,s=isFinite(+e)?Math.abs(e):0,i=void 0===n?",":n,r=void 0===a?".":a,l="";return l=(s?function(t,e){var a=Math.pow(10,e);return""+(Math.round(t*a)/a).toFixed(e)}(o,s):""+Math.round(o)).split("."),l[0].length>3&&(l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,i)),(l[1]||"").length<s&&(l[1]=l[1]||"",l[1]+=new Array(s-l[1].length+1).join("0")),l.join(r)},i=function(t,e){var a=null;return function(){var n=this,o=arguments;clearTimeout(a),a=setTimeout(function(){t.apply(n,o)},e)}},r=function(e,a){t.each(e,function(t,e){if(a.find('[data-error="'+t+'"]').length)a.find('[data-error="'+t+'"]').text(e[0]).show();else{var n=a.find('[name="'+t+'"]');n.length||(n=a.find('[name="'+t+'[]"]')),n.closest(".form-group").addClass("has-error"),e.length&&(n.closest(".form-group").find(".help-block").remove(),n.closest(".form-group").append('<span class="help-block">'+e[0]+"</span>"))}})},l=function(t,e,a){e?bootbox.confirm({message:t,buttons:{confirm:{label:"Confirm",className:"btn-warning"},cancel:{label:"Cancel",className:"btn-primary"}},callback:function(t){t&&(window.confirmCb?window.confirmCb():a&&a())}}):bootbox.alert({message:t,buttons:{ok:{className:"btn-primary"}}})},d=function(e,a){t("[data-alert]").removeClass().addClass("alert alert-"+a).find(".msg").text(e),t("html, body").animate({scrollTop:t("[data-alert]").offset().top-50})},c=function(){t("[data-alert]").removeClass().addClass("hidden").find(".msg").text("")},u=function(e){var a=t(e);a.closest("tbody").find("tr").not(a).removeClass("success"),a.closest("tbody").find('input[type="checkbox"]').not(a).prop("checked",!1),a.toggleClass("success"),a.find('input[type="checkbox"]').prop("checked",a.hasClass("success"))},m=function(e,a){t.each(e,function(e,a){var n=t('[data-bind="'+e+'"]');if(n.length){var o=n.prop("tagName").toLowerCase();switch(o){case"input":n.val(a);break;case"a":"href"===n.data("bind-attr")?n.attr("href",a):n.text(a);break;case"span":case"p":case"strong":n.text(a);break;default:console.warn("Invalid tagName: "+o)}}}),a&&a(e)},f=function(a){var o=t(a.table),s=t(a.filter),i=o.DataTable({paging:!1,searching:!1,info:!1,serverSide:!0,processing:!0,retrieve:!0,searchDelay:250,order:[[o.data("order-col"),o.data("order-type")]],ajax:{url:o.data("url"),data:function(e){t(a.search.input).length?e.search.value=t(a.search.input).val():e.search.value="",e.length=o.data("page-length"),e.page=e.start/e.length+1,s.length&&(e.filters={},s.find("input, select, textarea").each(function(){var a,n=t(this),o=n.attr("name");n.prop("nodeName").toLowerCase(),a=n.val(),e.filters[o]=a}))}},columns:a.columns,rowCallback:function(e,n){if(o.hasClass("js-modal-table")){var s=t(e);n.DT_RowId==="row_"+t(a.table).attr("data-selected-id")?(s.addClass("success"),s.find('input[type="checkbox"]').prop("checked",!0)):(s.removeClass("success"),s.find('input[type="checkbox"]').prop("checked",!1))}},drawCallback:function(o){var i=o.json.pagination,r=[],l=t(a.pagination.basic),d=t(a.pagination.table),c=s.find('[type="submit"]');if(c.text(c.data("text-default")),!0===n){document.getElementById("site-footer").scrollIntoView(!0)}if(l.length&&(l.find(".page-status").text(i.current+" of "+i.last),l.find(".page-total").text(i.total+" item"+(i.total>1?"s":"")),l.find('[data-page="first"]').attr("href",i.url.first),l.find('[data-page="last"]').attr("href",i.url.last),i.url.next?l.find('[data-page="next"]').attr("href",i.url.next).show():l.find('[data-page="next"]').hide(),i.url.prev?l.find('[data-page="previous"]').attr("href",i.url.prev).show():l.find('[data-page="previous"]').hide()),d.length){var u=i.current,m=i.last,f=e(i.current,i.last);r.push('<li><a href="#" class="page-first js-table-pager" data-page="first">&laquo;</a></li>'),r.push('<li><a href="#" class="page-prev js-table-pager" data-page="previous">&lsaquo;</a></li>');for(var p=f.startPage;p<=f.endPage;p++)p===u?r.push('<li class="active"><span>'+p+"</span></li>"):r.push('<li><a href="#" class="js-table-pager" data-page="'+(p-1)+'">'+p+"</a></li>");r.push('<li><a href="#" class="page-next js-table-pager" data-page="next">&rsaquo;</a></li>'),r.push('<li><a href="#" class="page-last js-table-pager" data-page="last">&raquo;</a></li>'),r.push('<li><input id="data-table-input" type="number" min="1" max="'+m+'" value="'+u+'"></input>&nbsp of &nbsp'+m+" Pages</li>"),d.empty().html(r.join("")),d.find('[data-page="first"]').attr("href",i.url.first),d.find('[data-page="last"]').attr("href",i.url.last),i.url.next?d.find('[data-page="next"]').attr("href",i.url.next).show():d.find('[data-page="next"]').hide(),i.url.prev?d.find('[data-page="previous"]').attr("href",i.url.prev).show():d.find('[data-page="previous"]').hide()}}}),r=t.fn.dataTable.util.throttle(function(){i.search(this.value),i.draw()},250);t(document).on("input","#data-table-input",function(){var e=parseInt(t(this).val());e<parseInt(t(this).attr("min"))?e=parseInt(t(this).attr("min")):e>parseInt(t(this).attr("max"))&&(e=parseInt(t(this).attr("max"))),t(this).val(e)}),t(document).off("click",".js-table-pager").on("click",".js-table-pager",function(e){e.preventDefault(),n=!1,i.page(t(this).data("page")).draw("page")}),t(document).on("change","#data-table-input",function(t){t.preventDefault(),i.page(t.target.value-1).draw("page")}),t(document).on("click",".scrollToBottom",function(t){t.preventDefault(),n=!0}),t(a.search.input).length&&t(document).off("keyup",a.search.input).on("keyup",a.search.input,r),t(a.search.form).length&&t(document).off("submit",a.search.form).on("submit",a.search.form,function(t){t.preventDefault(),r()}),t(document).off("submit",a.filter).on("submit",a.filter,function(e){e.preventDefault();var a=t(this).find('[type="submit"]');a.text(a.data("text-progress")),r()}),t(document).off("click",".js-modal-table tbody tr").on("click",".js-modal-table tbody tr",function(){u(this)})},p=function(e){var a=t(e.form);a.ajaxForm({clearForm:"1"===t.trim(a.data("reset")),resetForm:"1"===t.trim(a.data("reset")),beforeSubmit:function(){var a=t(e.btn);a.text(a.data("text-progress")),c(),e.beforeSubmitCb&&e.beforeSubmitCb()},success:function(a,n,o,s){e.successCb?e.successCb(a,n,o,s):d(a.msg,"success"),""!==t.trim(s.data("redirect"))&&setTimeout(function(){window.location=s.data("redirect")},3e3),""!==t.trim(a.redirect)&&setTimeout(function(){window.location=a.redirect},3e3),s.find('[name="comments"]').val(""),s.find('input[type="file"]').val(""),s.find(".js-file-selected").text("-")},error:function(t,n,o){var s=JSON.parse(t.responseText);"dialog"===s.type?l(s.msg,s.confirm):r(s.errors,a),e.errorCb&&e.errorCb(t,n,o)},complete:function(){var a=t(e.btn);a.text(a.data("text-default")),e.completeCb&&e.completeCb()}}).find("input, select, textarea").on("change keyup",i(function(){var e=t(this);e.closest(".form-group").removeClass("has-error"),e.closest(".form-group").find(".help-block").remove()},250)),t(e.btn).length&&!t.contains(a[0],t(e.btn)[0])&&t(e.btn).off("click").on("click",function(t){t.preventDefault(),a.submit()})},h=function(e){var n=t(".section-documents"),s=(n.data("project-id"),{id:n.data("id"),type:n.data("type")});t('[data-toggle="tooltip"]').tooltip("destroy"),t.get("/documents",s,function(t){n.html(Mustache.render(a,t)),o=t.documents}).always(function(){t('[data-toggle="tooltip"]').tooltip(),e&&e()})},g=function(){t.get(meta_url,function(t){m(t)})},b=function(e){var a=e.data("url"),n=[];e.html("Loading comments..."),t.get(a,function(a){a.length?(t.each(a,function(t,e){n.push('<div class="media">'),n.push('<div class="media-body">'),n.push('<p class="media-heading"><strong>'+e.name+'</strong> <small class="text-muted" title="'+e.date+'">'+e.diff+"</small></p>"),n.push(e.comment),n.push("</div>"),n.push("</div>"),t<a.length-1&&n.push('<hr style="margin:10px 0;">')}),t(".js-comments-count").text(a.length)):n.push("No comments found."),e.html(n.join(""))})};if(t(document).ready(function(){t(".js-well-comments").length&&(t(".js-toggle-comments").on("click",function(e){e.preventDefault();var a=t(this);"Hide"===a.text()?a.text("Show"):a.text("Hide"),t(".js-well-comments").toggle()}),b(t(".js-well-comments"))),p({form:".js-form",btn:'.js-form [type="submit"]',successCb:function(e){d(e.msg,"success"),"undefined"!=typeof meta_url&&g(),b(t(".js-well-comments"))}}),p({form:".js-form-comment",btn:'.js-form-comment [type="submit"]',successCb:function(e){d(e.msg,"success"),"undefined"!=typeof meta_url&&g(),b(t(".js-well-comments"))}}),t(document).on("change",".js-input-file",function(){var e=t(this),a=e.val(),n=t.trim(a.replace(/\\/g,"/").replace(/.*\//,""));""!==t.trim(e.data("target"))?t(e.data("target")).text(n):t(".js-file-selected").text(n)}),t('.close[data-dismiss="alert"]').on("click",function(t){t.preventDefault(),c()}),t(".js-datepicker").each(function(){var e=t(this);t(e).datepicker({format:"dd/mm/yyyy",autoHide:!0})}),t(".js-datepicker-disable-future").each(function(){var e=t(this);t(e).datepicker({format:"dd/mm/yyyy",autoHide:!0,endDate:"today"})}),t(".js-select").each(function(){t(this).select2()}),t(".js-stretch").length&&autosize(t(".js-stretch")),t(".section-documents").length&&h(),t("#modal-create-document").on("shown.bs.modal",function(){t('[name="documentable_type"]').val(documentable_type),t('[name="documentable_id"]').val(documentable_id),p({form:"#modal-create-document .js-modal-form",btn:"#modal-create-document .btn-submit-modal-form",successCb:function(e,a,n,o){h(function(){t("#modal-create-document").modal("hide")}),g()}})}),t("#modal-edit-document").on("shown.bs.modal",function(e){var a=t(this),n=t(e.relatedTarget),s=parseInt(n.data("id"),10);t.each(o,function(t,e){e.id===s&&(a.find(".js-file-selected").text(e.filename),a.find('[name="type"]').val(e.type),a.find('[name="comments"]').val(e.comments_raw),autosize.update(a.find(".js-stretch")))}),t('[name="documentable_type"]').val(documentable_type),t('[name="documentable_id"]').val(documentable_id),a.find(".js-modal-form").attr("action",n.data("edit-url")),p({form:"#modal-edit-document .js-modal-form",btn:"#modal-edit-document .btn-submit-modal-form",successCb:function(e,a,n,o){h(function(){t("#modal-edit-document").modal("hide")}),g()}})}),t("#modal-edit-document").on("hidden.bs.modal",function(e){t(this).find(".js-modal-form").attr("action","#")}),t("#modal-create-document").on("hide.bs.modal",function(){var e=t(this);e.find(".js-file-selected").text("-"),e.find(".js-modal-form")[0].reset()}),t(document).on("click",".js-delete-document",function(e){e.preventDefault();var a=t(this);l("Are you sure you want to delete this document?",!0,function(){a.find(".fa").removeClass("fa-times").addClass("fa-spinner fa-pulse fa-fw"),t.post(a.data("delete-url"),function(t){h(),g()}).fail(function(){d("Something went wrong, please try again later.","danger")}).always(function(){a.find(".fa").removeClass("fa-spinner fa-pulse fa-fw").addClass("fa-times")})})})}),t(".yearly-reports").length&&t("#year").change(function(){var t=document.getElementById("yearlyReports").action,e=document.getElementById("btnSubmit").value,a=document.getElementById("year").value,n=t.replace(e,a);document.getElementById("btnSubmit").value=a,document.getElementById("yearlyReports").action=n}),t(".date-range-reports").length){var v,y,w;t("#date_start").change(function(){var t=document.getElementById("date_start").value.split("/"),e=t[2]+"-"+t[1]+"-"+t[0],a=document.getElementById("dateRangeReports").action;y=a.split("downloaddaterange/"),w=y[1].split("/"),v=y[0]+"downloaddaterange/"+e+"/"+w[1],document.getElementById("dateRangeReports").action=v}),t("#date_end").change(function(){var t=document.getElementById("date_end").value.split("/"),e=t[2]+"-"+t[1]+"-"+t[0],a=document.getElementById("dateRangeReports").action;y=a.split("downloaddaterange/"),w=y[1].split("/"),v=y[0]+"downloaddaterange/"+w[0]+"/"+e,document.getElementById("dateRangeReports").action=v}),t("#modal-activity").on("shown.bs.modal",function(){f({table:"#modal-activity .js-modal-table",filter:"#modal-activity .js-modal-table-filter",search:{form:"#modal-activity .js-table-search-form",input:"#modal-activity .js-table-search-input"},pagination:{basic:"#modal-activity .pagination-basic",table:""},columns:[{data:"id",className:"text-center"},{data:"event",className:"text-center"},{data:"subjectID",className:"text-center"},{data:"properties",className:"text-center"},{data:"updated_at",className:"text-center"},{data:"updated_by",className:"text-center"}]})})}window.debounce=i,window.showAlert=d,window.showDialog=l,window.initDatatable=f,window.initForm=p,window.updateBindings=m,window.numberFormat=s,window.updateUpdatedBy=g}(jQuery);
//# sourceMappingURL=app.min.js.map

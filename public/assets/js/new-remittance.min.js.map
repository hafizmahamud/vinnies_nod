{"version":3,"sources":["new-remittance.js"],"names":["$","projectDonationsTmpl","html","twinningDonationsTmpl","grantDonationsTmpl","councilDonationsTmpl","Mustache","parse","updateListing","document_id","type","get","remittance_donation_url","res","form","tmpl","types","projects","twinning","grants","council","render","updateBindings","total","initForm","btn","successCb","responseText","statusText","xhr","$form","id","errorCb","status","error","errors","JSON","document","length","showDialog","fail","msg","confirm","always","updateUpdatedBy","ready","initDatatable","table","filter","search","input","pagination","basic","columns","data","className","row","each","this","on","e","preventDefault","$this","window","location","attr","jQuery"],"mappings":"AAWA,cAEA,SAAWA,GACP,GAAIC,GAAwBD,EAAE,+BAA+BE,OACzDC,EAAwBH,EAAE,gCAAgCE,OAC1DE,EAAwBJ,EAAE,6BAA6BE,OACvDG,EAAwBL,EAAE,+BAA+BE,MAE7DI,UAASC,MAAMN,GACfK,SAASC,MAAMJ,GACfG,SAASC,MAAMH,GACfE,SAASC,MAAMF,EAEf,IAAIG,GAAgB,SAAUC,EAAaC,GACvCV,EAAEW,IAAIC,yBAA0BH,YAAaA,EAAaC,KAAMA,GAAO,SAAUG,GAC7E,GAAIC,GACAC,CAEJ,QAAQL,GACJ,IAAKM,OAAMC,SACPF,EAAOd,EACPa,EAAO,SACP,MAEJ,KAAKE,OAAME,SACPH,EAAOZ,EACPW,EAAO,UACP,MAEJ,KAAKE,OAAMG,OACPJ,EAAOX,EACPU,EAAO,OACP,MAEJ,KAAKE,OAAMI,QACPL,EAAOV,EACPS,EAAO,UAIfd,EAAE,oCAAsCU,EAAO,MAAMR,KAAKI,SAASe,OAAON,EAAMF,IAChFS,eAAeT,EAAIU,OAEnBC,UACIV,KAAM,gCAAkCA,EACxCW,IAAK,gCAAkCX,EAAO,yBAC9CY,UAAW,SAAUC,EAAcC,EAAYC,EAAKC,GAChDtB,EAAcmB,EAAaI,GAAIJ,EAAajB,OAEhDsB,QAAS,SAAUH,EAAKI,EAAQC,GAC5B,GAAIC,GAASC,KAAK7B,MAAMsB,EAAIF,aAExBQ,GAAOA,OAAOE,SAASC,QACvBC,WAAWJ,EAAOA,OAAOE,SAAS,IAAI,MAKlDb,UACIV,KAAM,4BAA8BA,EACpCW,IAAK,4BAA8BX,EAAO,yBAC1CY,UAAW,SAAUC,EAAcC,EAAYC,EAAKC,GAChDtB,GAAc,EAAOmB,EAAajB,WAG3C8B,KAAK,SAAUX,EAAKI,EAAQC,GAC3B,GAAIC,GAASC,KAAK7B,MAAMsB,EAAIF,aAER,YAAhBQ,EAAOzB,MACP6B,WAAWJ,EAAOM,IAAKN,EAAOO,WAEnCC,OAAO,WACNC,oBAIR5C,GAAEqC,UAAUQ,MAAM,WACV7C,EAAE,aAAasC,QACfQ,eACIC,MAAO,YACPC,OAAQ,mBACRC,QACInC,KAAM,wBACNoC,MAAO,0BAEXC,YACIC,MAAO,oBACPL,MAAO,qBAEXM,UAEQC,KAAM,KACNC,UAAW,cACXlC,OAAQ,SAAUiC,EAAM5C,EAAM8C,GAC1B,MAAO,kCAAoCF,EAAO,KAAOA,EAAO,UAIpEA,KAAM,QACNC,UAAW,gBAGXD,KAAM,OACNC,UAAW,gBAGXD,KAAM,aACNC,UAAW,gBAGXD,KAAM,cACNC,UAAW,gBAGXD,KAAM,UACNC,UAAW,gBAGXD,KAAM,OACNC,UAAW,gBAGXD,KAAM,QACNC,UAAW,gBAGXD,KAAM,WACNC,UAAW,gBAGXD,KAAM,WACNC,UAAW,gBAGXD,KAAM,SACNC,UAAW,gBAGXD,KAAM,WACNC,UAAW,gBAGXD,KAAM,cACNC,UAAW,kBAMvBvD,EAAE,yBAAyBsC,QAC3BtC,EAAE,yBAAyByD,KAAK,WAC5BjD,GAAc,EAAOR,EAAE0D,MAAMJ,KAAK,WAItCtD,EAAE,6BAA6BsC,SAC/BtC,EAAE,8BAA8B2D,GAAG,QAAS,SAAUC,GAClDA,EAAEC,gBAEF,IAAIC,GAAQ9D,EAAE0D,KAEdnB,YAAW,iEAAiE,EAAM,WAC9EwB,OAAOC,SAAWF,EAAMG,KAAK,YAIrCjE,EAAE,gCAAgC2D,GAAG,QAAS,SAAUC,GACpDA,EAAEC,gBAEF,IAAIC,GAAQ9D,EAAE0D,KAEdnB,YAAW,yNAAyN,EAAM,WACtOwB,OAAOC,SAAWF,EAAMG,KAAK,gBAK9CC","file":"new-remittance.min.js","sourcesContent":["/* global initDatatable */\r\n/* global initForm */\r\n/* global remittance_donation_url */\r\n/* global showDialog */\r\n/* global types */\r\n/* global Mustache */\r\n/* global updateBindings */\r\n/* global debounce */\r\n/* global numberFormat */\r\n/* global updateUpdatedBy */\r\n\r\n'use strict';\r\n\r\n(function ($) {\r\n    var projectDonationsTmpl  = $('#mustache-project-donations').html();\r\n    var twinningDonationsTmpl = $('#mustache-twinning-donations').html();\r\n    var grantDonationsTmpl    = $('#mustache-grant-donations').html();\r\n    var councilDonationsTmpl  = $('#mustache-council-donations').html();\r\n\r\n    Mustache.parse(projectDonationsTmpl);\r\n    Mustache.parse(twinningDonationsTmpl);\r\n    Mustache.parse(grantDonationsTmpl);\r\n    Mustache.parse(councilDonationsTmpl);\r\n\r\n    var updateListing = function (document_id, type) {\r\n        $.get(remittance_donation_url, {document_id: document_id, type: type}, function (res) {\r\n            var form;\r\n            var tmpl;\r\n\r\n            switch (type) {\r\n                case types.projects:\r\n                    tmpl = projectDonationsTmpl;\r\n                    form = 'project';\r\n                    break;\r\n\r\n                case types.twinning:\r\n                    tmpl = twinningDonationsTmpl;\r\n                    form = 'twinning';\r\n                    break;\r\n\r\n                case types.grants:\r\n                    tmpl = grantDonationsTmpl;\r\n                    form = 'grant';\r\n                    break;\r\n\r\n                case types.council:\r\n                    tmpl = councilDonationsTmpl;\r\n                    form = 'council';\r\n                    break;\r\n            }\r\n\r\n            $('.remittance-donations[data-type=\"' + type + '\"]').html(Mustache.render(tmpl, res));\r\n            updateBindings(res.total);\r\n\r\n            initForm({\r\n                form: '.js-remittance-document-form-' + form,\r\n                btn: '.js-remittance-document-form-' + form + ' button[type=\"submit\"]',\r\n                successCb: function (responseText, statusText, xhr, $form) {\r\n                    updateListing(responseText.id, responseText.type);\r\n                },\r\n                errorCb: function (xhr, status, error) {\r\n                    var errors = JSON.parse(xhr.responseText);\r\n\r\n                    if (errors.errors.document.length) {\r\n                        showDialog(errors.errors.document[0], false);\r\n                    }\r\n                }\r\n            });\r\n\r\n            initForm({\r\n                form: '.js-delete-document-form-' + form,\r\n                btn: '.js-delete-document-form-' + form + ' button[type=\"submit\"]',\r\n                successCb: function (responseText, statusText, xhr, $form) {\r\n                    updateListing(false, responseText.type);\r\n                }\r\n            });\r\n        }).fail(function (xhr, status, error) {\r\n            var errors = JSON.parse(xhr.responseText);\r\n\r\n            if (errors.type === 'dialog') {\r\n                showDialog(errors.msg, errors.confirm);\r\n            }\r\n        }).always(function() {\r\n            updateUpdatedBy();\r\n        });\r\n    };\r\n\r\n    $(document).ready(function () {\r\n        if ($('.js-table').length) {\r\n            initDatatable({\r\n                table: '.js-table',\r\n                filter: '.js-table-filter',\r\n                search: {\r\n                    form: '.js-table-search-form',\r\n                    input: '.js-table-search-input',\r\n                },\r\n                pagination: {\r\n                    basic: '.pagination-basic',\r\n                    table: '.pagination-table',\r\n                },\r\n                columns: [\r\n                    {\r\n                        data: 'id',\r\n                        className: 'text-center',\r\n                        render: function (data, type, row) {\r\n                            return '<a href=\"/remittances/new/edit/' + data + '\">' + data + '</a>';\r\n                        },\r\n                    },\r\n                    {\r\n                        data: 'state',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'date',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'created_at',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'approved_at',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'quarter',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'year',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'total',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'projects',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'twinning',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'grants',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'councils',\r\n                        className: 'text-center',\r\n                    },\r\n                    {\r\n                        data: 'is_approved',\r\n                        className: 'text-center',\r\n                    },\r\n                ]\r\n            });\r\n        }\r\n\r\n        if ($('.remittance-donations').length) {\r\n            $('.remittance-donations').each(function () {\r\n                updateListing(false, $(this).data('type'));\r\n            });\r\n        }\r\n\r\n        if ($('.new-remittance-edit-form').length) {\r\n            $('.js-btn-approve-remittance').on('click', function (e) {\r\n                e.preventDefault();\r\n\r\n                var $this = $(this);\r\n\r\n                showDialog('Are you sure you want to approve and process this remittance?', true, function () {\r\n                    window.location = $this.attr('href');\r\n                });\r\n            });\r\n\r\n            $('.js-btn-unapprove-remittance').on('click', function (e) {\r\n                e.preventDefault();\r\n\r\n                var $this = $(this);\r\n\r\n                showDialog('Are you sure you want to reinstate edit mode for this remittance?<br><br><strong>After confirmation, please remember to delete Project Payments automatically added by this remittance on previous approval.</strong>', true, function () {\r\n                    window.location = $this.attr('href');\r\n                });\r\n            });\r\n        }\r\n    });\r\n})(jQuery);\r\n"]}